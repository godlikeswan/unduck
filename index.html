<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html,
    body {
      color: #222;
      background: #fff;
    }

    @media (prefers-color-scheme: dark) {

      html,
      body {
        color: #eee;
        background: #121212;
      }
    }
  </style>
  <title>Document</title>
</head>

<body>
  <script>
    // To add new: https://raw.githubusercontent.com/onasman/bangs/refs/heads/main/src/bang.ts
    // Search for `t: "<bang>"`
    const bangs = [
      {
        c: "Multimedia",
        d: "duckduckgo.com",
        r: 57,
        s: "DuckDuckGo",
        sc: "Images",
        t: "duckduckgo",
        u: "https://duckduckgo.com/?q={{{s}}}",
      },
      {
        c: "Research",
        d: "en.wiktionary.org",
        r: 16682,
        s: "Wiktionary",
        sc: "Reference (words)",
        t: "wt",
        u: "https://en.wiktionary.org/w/index.php?search={{{s}}}&title=Special%3ASearch&go=Go",
      },
    ]

    const LS_DEFAULT_BANG = "duckduckgo";
    const defaultBang = bangs.find((b) => b.t === LS_DEFAULT_BANG);

    function getBangredirectUrl() {
      const url = new URL(window.location.href);
      const query = url.searchParams.get("q")?.trim() ?? "";

      const match = query.match(/!(\S+)/i);

      const bangCandidate = match?.[1]?.toLowerCase();
      const selectedBang = bangs.find((b) => b.t === bangCandidate) ?? defaultBang;

      // Remove the first bang from the query
      const cleanQuery = query.replace(/!\S+\s*/i, "").trim();

      if (!cleanQuery) return 'https://duckduckgo.com';

      // Format of the url is:
      // https://www.google.com/search?q={{{s}}}
      const searchUrl = selectedBang?.u.replace(
        "{{{s}}}",
        // Replace %2F with / to fix formats like "!ghr+t3dotgg/unduck"
        encodeURIComponent(cleanQuery).replace(/%2F/g, "/")
      );
      if (!searchUrl) return 'https://duckduckgo.com';

      return searchUrl;
    }

    function doRedirect() {
      const searchUrl = getBangredirectUrl();
      if (!searchUrl) return;
      window.location.replace(searchUrl);
    }

    doRedirect();
  </script>
</body>

</html>